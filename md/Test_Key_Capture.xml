<?xml version="1.0" encoding="ISO-8859-1" ?>
<mdscript name="Test_Key_Capture" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">

<!--
Test cue that excercises the key capture library.
Relies on named pipe library; server side is written in python.
-->

<cues>
  
  <!-- 
    Testing cue will restart every so many seconds.
    This makes it a little more useful with /refreshmd commands.
  -->
  <cue name="Test_Key_Capture" instantiate="true" namespace="this" checkinterval="10s" checktime="30s">
  
    <conditions>
      <!-- Uncomment to disable this cue. -->
      <check_value value="false"/>
    </conditions>>
  
    <actions>
      <!-- Set up some names.-->
      <set_value name="$Debug_File_Name" exact="'responses.log'"/>
      <set_value name="$Debug_Directory" exact="'interface'"/>
      
      <show_notification text="'Test_Key_Capture started'" sound="notification_warning" priority="2" />
      
      <!-- Register a key with a callback. -->
      <signal_cue_instantly cue="md.LIB_Key_Capture.Register_Key" param="table[$key='a', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.LIB_Key_Capture.Register_Key" param="table[$key='shift s', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.LIB_Key_Capture.Register_Key" param="table[$key='ctrl_l d', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.LIB_Key_Capture.Register_Key" param="table[$key='alt_r f', $cue=OnKeyPress]"/>
            
    </actions>
    
    <cues>
    </cues>
  </cue>
  
      
  <!-- Handle pressed keys. -->
  <cue name="OnKeyPress" instantiate="true" namespace="this">
    <conditions>
      <event_cue_signalled/>
    </conditions>    
    <actions>
      <!-- Pull the value out of the param. -->
      <set_value name="$key" exact="event.param"/>
      <!-- Log it. -->
      <raise_lua_event name="'directChatMessageReceived'" param="'Key Capture;' + $key"/>      
    </actions>
  </cue>
      
</cues>

</mdscript>