<?xml version="1.0" encoding="ISO-8859-1" ?>
<mdscript name="Test_Key_Capture" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">

<!--
Test cue that excercises the key capture library.
Relies on named pipe library; server side is written in python.
-->

<cues>

  <!--
    Register keys with the key capture api.
  -->  
  <cue name="Register_Keys" instantiate="true">
    <conditions>
      <event_cue_signalled cue="md.Key_Capture.Reloaded" />
      <!-- Uncomment to disable this cue.
      <check_value value="false"/> -->
    </conditions>
    <actions>
      <show_notification text="'Registering keys'" sound="notification_warning" priority="2" />
      <!-- Register a key with a callback. -->
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='a', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='s', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='d', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='f', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='shift s', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='ctrl_l d', $cue=OnKeyPress]"/>
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='alt_r f', $cue=OnKeyPress]"/>
    </actions>
  </cue>
        
  <!-- Handle pressed keys. -->
  <cue name="OnKeyPress" instantiate="true" namespace="this">
    <conditions>
      <event_cue_signalled/>
    </conditions>    
    <actions>
      <!-- Pull the value out of the param. -->
      <set_value name="$key" exact="event.param"/>
      <!-- Log it. -->
      <raise_lua_event name="'directChatMessageReceived'" param="'Key Capture;' + $key"/>      
    </actions>
  </cue>
      
</cues>

</mdscript>