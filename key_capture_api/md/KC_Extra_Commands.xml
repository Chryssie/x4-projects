<?xml version="1.0" encoding="utf-8" ?>
<mdscript name="KC_Extra_Commands" 
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--
  Create some extra key-press activated commands.
  Acts as an example of using the key capture api, as well as hopefully
  being useful.
  
  Ideas:
  disable_collisions_between : turn on/off collision with player and target
  -->

  <cues>
    <!-- Register keys with the key capture api. -->
    <cue name="Register_Keys" instantiate="true">
      <conditions>
        <event_cue_signalled cue="md.Key_Capture.Reloaded" />
        <!-- Uncomment to disable this cue.
        <check_value value="false"/> -->
      </conditions>
      <actions>
        <!--<show_notification text="'Registering KC_Extra_Commands keys'" 
                           sound="notification_warning" priority="2" />-->
        
        <!-- Register a shortcut with a callback. -->
        <signal_cue_instantly cue="md.Key_Capture.Register_Shortcut" param="table[
          $id = 'kc_target_follow', 
          $onPress = Target_Follow,
          $name = 'Follow Target', 
          $description = 'Turns on autopilot to follow the target'
          ]"/>
        
      </actions>
    </cue>
    
    <!-- Auto-follow target ship. -->
    <cue name="Target_Follow" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player has a target selected. -->
        <check_value value="player.target"/>
        <!-- Verify the player is piloting a ship.-->
        <!-- TODO: check this in key capture api instead (space/flying context).-->
        <check_value value="player.occupiedship"/>
      </conditions>
      <actions>
        <!-- Debug message. -->
        <!-- <raise_lua_event name="'directChatMessageReceived'" param="'KeyCapture;Starting Target_Follow'"/> -->
                
        <!-- Cancel autopilot if the target is already the current dest.-->
        <do_if value="player.target == player.autopilottarget">
          <stop_player_autopilot />
        </do_if>
        <!-- Start autopiloting to target. Should continuously follow. -->
        <do_else>
          <start_player_autopilot destination="player.target"/>          
        </do_else>
      </actions>
    </cue>


  </cues>

</mdscript>