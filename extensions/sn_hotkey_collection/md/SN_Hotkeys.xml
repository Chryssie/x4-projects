<?xml version="1.0" encoding="utf-8" ?>
<mdscript name="SN_Hotkey_Collection" 
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--
  Create some extra key-press activated commands.
  Acts as an example of using the hotkey api, as well as hopefully
  being useful.
  
  Ideas:
  disable_collisions_between : turn on/off collision with player and target
  zoom: zoom in using fov adjustment (needs care to avoid fov getting stuck)
  -->

  <cues>
    <!-- Register keys with the hotkey api. -->
    <cue name="Register_Keys" instantiate="true">
      <conditions>
        <event_cue_signalled cue="md.Hotkey_API.Reloaded" />
      </conditions>
      <actions>
        
        <!-- Register actions. -->
        <signal_cue_instantly cue="md.Hotkey_API.Register_Action" param="table[
          $id = 'kc_target_follow', 
          $onPress = Target_Follow,
          $name = 'Follow Target', 
          $description = 'Turns on autopilot to follow the target',
          $contexts = ['flying'],
          ]"/>

        <signal_cue_instantly cue="md.Hotkey_API.Register_Action" param="table[
          $id = 'kc_eject_illegals', 
          $onPress = Eject_Illegals,
          $name = 'Eject Illegal Wares', 
          $description = 'Eject any player inventory or piloted ship cargo that is illegal in the player zone',
          $contexts = ['flying'],
          ]"/>

        <signal_cue_instantly cue="md.Hotkey_API.Register_Action" param="table[
          $id = 'kc_launch_satellite', 
          $onPress = Launch_Satellite,
          $name = 'Launch Satellite', 
          $description = 'Launches a satellite from the player piloted ship',
          $contexts = ['flying'],
          ]"/>

        <signal_cue_instantly cue="md.Hotkey_API.Register_Action" param="table[
          $id = 'kc_launch_adv_satellite', 
          $onPress = Launch_Adv_Satellite,
          $name = 'Launch Advanced Satellite', 
          $description = 'Launches an advanced satellite from the player piloted ship',
          $contexts = ['flying'],
          ]"/>
        
        <!--TODO: deploy mines/etc.-->

        <!--Debug keys. TODO: move elsewhere.
        <signal_cue_instantly cue="md.Hotkey_API.Register_Action" param="table[
          $id = 'kc_print_combined_skill', 
          $onPress = Print_Combined_Skill,
          $name = 'Print Combined Skill', 
          $category = 'Debug',
          $description = 'Prints the combined skill of the current target',
          $contexts = ['flying','walking'],
          ]"/>-->
      </actions>
    </cue>
    
    <!-- Auto-follow target ship. -->
    <cue name="Target_Follow" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player has a target selected. -->
        <check_value value="player.target"/>
        <!-- Verify the player is piloting a ship.-->
        <!-- TODO: check this in hotkey api instead (space/flying context).-->
        <check_value value="player.occupiedship"/>
      </conditions>
      <actions>
        <!-- Debug message. -->
        <!--<raise_lua_event name="'directChatMessageReceived'" param="'KeyCapture;Starting Target_Follow'"/>-->
        <!--<debug_text text="'KeyCapture Triggered Target_Follow'" filter="general"/>-->
                
        <!-- Cancel autopilot if the target is already the current dest.-->
        <do_if value="player.target == player.autopilottarget">
          <stop_player_autopilot />
          <show_notification text="{10002, 921}" comment="Autopilot Disengaged"/>
        </do_if>
        <!-- Start autopiloting to target. Should continuously follow. -->
        <do_else>
          <start_player_autopilot destination="player.target"/>
          <!-- This already puts up a notification on its own. -->
        </do_else>
      </actions>
    </cue>

    <!-- Drop illegal wares. -->
    <cue name="Eject_Illegals" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player is piloting a ship.-->
        <check_value value="player.occupiedship"/>
      </conditions>
      <actions>
        <!-- Debug message. -->
        <!--<raise_lua_event name="'directChatMessageReceived'" param="'KeyCapture;Ejecting_Illegals'"/>-->
        <!--<debug_text text="'KeyCapture Triggered Ejecting_Illegals'" filter="general"/>-->

        <set_value name="$faction" exact="player.zone.policefaction"/>
        <drop_illegal_cargo groupname="$boxes" object="player.occupiedship" faction="$faction"/>
        <drop_illegal_inventory groupname="$boxes" object="player.entity" faction="$faction"/>
        <do_if value="$boxes.count != 0">
          <show_notification text="'Ejected Illegal Wares'"/>
        </do_if>
        <do_else>
          <show_notification text="'No Illegal Wares'"/>          
        </do_else>
        
      </actions>
    </cue>

    <cue name="Launch_Satellite" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player is piloting a ship.-->
        <check_value value="player.occupiedship"/>
      </conditions>
      <actions>
        <!--Try basic satellites-->
        <do_if value="player.occupiedship.ammostorage.{macro.eq_arg_satellite_01_macro}.count gt 0">
          <launch_satellite object="player.occupiedship" macro="macro.eq_arg_satellite_01_macro"/>
          <show_notification text="'Launched satellite'"/>
        </do_if>
        <do_else>
          <show_notification text="'No satellites available'"/>
        </do_else>
      </actions>
    </cue>

    <cue name="Launch_Adv_Satellite" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player is piloting a ship.-->
        <check_value value="player.occupiedship"/>
      </conditions>
      <actions>
        <!--Try advanced satellites-->
        <do_if value="player.occupiedship.ammostorage.{macro.eq_arg_satellite_02_macro}.count gt 0">
          <launch_satellite object="player.occupiedship" macro="macro.eq_arg_satellite_02_macro"/>
          <show_notification text="'Launched advanced satellite'"/>
        </do_if>
        <do_else>
          <show_notification text="'No advanced satellites available'"/>
        </do_else>
      </actions>
    </cue>

    <!--For the current target, return the combined skill value.-->
    <cue name="Print_Combined_Skill" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled/>
        <!-- Verify the player has a target selected. -->
        <check_value value="player.target"/>
      </conditions>
      <actions>
        <show_notification text="'Skill: '+player.target.combinedskill"/>
      </actions>
    </cue>
    

  </cues>

</mdscript>