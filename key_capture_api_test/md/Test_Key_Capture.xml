<?xml version="1.0" encoding="ISO-8859-1" ?>
<mdscript name="Test_Key_Capture" 
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<!--
Test cue that excercises the key capture library.
Relies on named pipe library; server side is written in python.
-->

<cues>

  <!--
    Register keys with the key capture api.
  -->  
  <cue name="Register_Keys" instantiate="true">
    <conditions>
      <event_cue_signalled cue="md.Key_Capture.Reloaded" />
      <!-- Uncomment to disable this cue.
      <check_value value="false"/> -->
    </conditions>
    <actions>
      <show_notification text="'Registering keys'" sound="notification_warning" priority="2" />
      
      <!-- Register some shortcuts. -->
      <signal_cue_instantly cue="md.Key_Capture.Register_Shortcut" param="table[
        $id = 'key_capture_test_space', 
        $onPress   = OnKeyEvent,
        $onRelease = OnKeyEvent,
        $onRepeat  = OnKeyEvent,
        $name = 'Test Space', 
        $description = 'Key Capture test Space',
        $contexts = table[$flying = true],
        $category = 'Test Space Keys',
        ]"/>

      <signal_cue_instantly cue="md.Key_Capture.Register_Shortcut" param="table[
        $id = 'key_capture_test_walk', 
        $onPress = OnKeyEvent,
        $name = 'Test Walk', 
        $description = 'Key Capture test Walk',
        $contexts = table[$walking = true],
        $category = 'Test Walk Keys',
        ]"/>

      <signal_cue_instantly cue="md.Key_Capture.Register_Shortcut" param="table[
        $id = 'key_capture_test_menu', 
        $onPress = OnKeyEvent,
        $name = 'Test Menu', 
        $description = 'Key Capture test Menu',
        $contexts = table[$menus = true],
        $category = 'Test Menu Keys',
        ]"/>

      <signal_cue_instantly cue="md.Key_Capture.Register_Shortcut" param="table[
        $id = 'key_capture_test_api_menu', 
        $onPress = OnKeyEvent,
        $name = 'Test Simple Menu', 
        $description = 'Key Capture test Simple Menu API',
        $contexts = table[$menu_names = ['SimpleMenu']],
        $category = 'Test Menu Keys',
        ]"/>

      <!-- Set up some default keys.  -->
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='a',       $id = 'key_capture_test_space']" /> 
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='s',       $id = 'key_capture_test_space']" /> 
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='d',       $id = 'key_capture_test_space']" /> 
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='f',       $id = 'key_capture_test_space']" /> 
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='shift s', $id = 'key_capture_test_walk']" /> 
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='ctrl_l d',$id = 'key_capture_test_menu']" />
      <signal_cue_instantly cue="md.Key_Capture.Register_Key" param="table[$key='alt_r f', $id = 'key_capture_test_api_menu']" />
    </actions>
  </cue>
        
  <!-- Handle press/repeat/release events. -->
  <cue name="OnKeyEvent" instantiate="true" namespace="this">
    <conditions>
      <event_cue_signalled/>
    </conditions>    
    <actions>
      <!-- Log it. -->
      <raise_lua_event name="'directChatMessageReceived'" 
                       param="'key;%s (%s %s)'.[event.param.$id, 
                                                event.param.$context, 
                                                event.param.$event]"/>
    </actions>
  </cue>
      
</cues>

</mdscript>